# View History 데이터 저장 용량 계산

## 📊 요구사항
- **영상 수**: 1,000개
- **보관 기간**: 10일
- **스냅샷 간격**: 1시간
- **키워드**: 관계없이 모든 영상

## 🧮 데이터 수 계산

### 총 스냅샷 수
```
1,000개 영상 × 240시간(10일) = 240,000개 스냅샷
```

### 일일 증가량
```
1,000개 영상 × 24시간 = 24,000개/일
```

### 현재 vs 변경 후
- **이전 (1분 간격)**: 1,000개 × 1,440분 = 1,440,000개/일 ❌
- **현재 (1시간 간격)**: 1,000개 × 24시간 = 24,000개/일 ✅

## 💾 저장 용량 계산

### 테이블 구조 (`view_history`)
```sql
- id (UUID): 16 bytes
- video_id (TEXT): ~11 bytes (YouTube ID 평균)
- view_count (BIGINT): 8 bytes
- fetched_at (TIMESTAMPTZ): 8 bytes
- created_at (TIMESTAMPTZ): 8 bytes
```

### 행당 크기
```
기본 데이터: 16 + 11 + 8 + 8 + 8 = 51 bytes
PostgreSQL 오버헤드: ~24 bytes
인덱스 오버헤드: ~25 bytes
─────────────────────────────────
총 예상 크기: ~100 bytes/row
```

### 총 저장 용량
```
240,000 rows × 100 bytes = 24 MB (데이터만)
인덱스 포함: ~48 MB
```

## ✅ Supabase 제한 확인

### Free Tier
- **데이터베이스 용량**: 500 MB
- **240,000개 스냅샷**: ~48 MB ✅ **충분함**

### Pro Tier
- **데이터베이스 용량**: 8 GB
- **240,000개 스냅샷**: ~48 MB ✅ **여유있음**

## 🔄 자동 정리 메커니즘

### 현재 설정 (`view_tracking_config`)
```sql
retention_hours: 240 (10일)
max_entries: 240 (영상당 최대 240개)
```

### 정리 로직
1. **시간 기반 정리**: 10일 이전 데이터 자동 삭제
2. **개수 기반 정리**: 영상당 240개 초과 시 오래된 것 삭제
3. **슬라이딩 윈도우**: 항상 최신 10일치만 유지

## 📈 확장성

### 영상 수 증가 시
| 영상 수 | 10일치 스냅샷 | 예상 용량 |
|---------|--------------|----------|
| 1,000개 | 240,000개 | ~48 MB |
| 5,000개 | 1,200,000개 | ~240 MB |
| 10,000개 | 2,400,000개 | ~480 MB |

### Free Tier 한계
```
500 MB ÷ 48 MB = 약 10,000개 영상까지 가능
```

## 🎯 결론

### 최대 저장 가능한 데이터 수
- **현재 설정**: **240,000개 스냅샷** (1,000개 영상 × 10일)
- **Supabase Free Tier**: **충분히 가능** (~48 MB)
- **자동 정리**: 10일 이전 데이터는 자동 삭제되어 용량 유지

### 권장 사항
1. ✅ **1시간 간격 유지**: 1분 간격 대비 60배 효율적
2. ✅ **10일 보관**: VPH 계산에 충분한 기간
3. ✅ **자동 정리 활성화**: `retention_hours`와 `max_entries` 설정 확인
4. ✅ **모니터링**: 주기적으로 테이블 크기 확인

