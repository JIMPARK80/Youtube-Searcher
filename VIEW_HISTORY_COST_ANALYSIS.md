# View History 데이터 조회 비용 분석

## 🔍 질문: 검색어를 바꾸면서 새로고침해서 view_history를 계속 가져와도 비용이 들지 않나요?

## ✅ 답변: **비용이 전혀 들지 않습니다!**

## 📊 Supabase Free Tier 제한

### API 요청
- **Free Tier**: **무제한** ✅
- **비용**: **$0** (무료)

### 데이터 전송량 (Egress)
- **Free Tier**: 5 GB/월
- **비용**: 초과 시에만 과금

## 📈 View History 조회 시나리오 분석

### 1회 VPH 계산당 데이터 전송량

```javascript
// getRecentVelocityForVideo() 호출 시
- view_history SELECT (최근 2개): 1회
- view_history SELECT (최초 1개): 1회
```

**응답 데이터 크기:**
```json
// 각 스냅샷 응답 예시
{
  "view_count": 246625,
  "fetched_at": "2025-11-25T18:48:59.071Z"
}
```

**예상 크기:**
- 각 스냅샷: 약 50-100 bytes
- 3개 스냅샷 (최근 2개 + 최초 1개): 약 150-300 bytes
- HTTP 헤더 포함: 약 200-400 bytes per VPH 계산

### 시나리오별 데이터 전송량

#### 시나리오 1: 하루 10회 검색, 각 10개 영상
```
VPH 계산: 10회 × 10개 × 2회 쿼리 = 200회 쿼리
전송량: 200회 × 300 bytes = 60 KB
```

#### 시나리오 2: 하루 50회 검색, 각 10개 영상
```
VPH 계산: 50회 × 10개 × 2회 쿼리 = 1,000회 쿼리
전송량: 1,000회 × 300 bytes = 300 KB
```

#### 시나리오 3: 한 달간 매일 50회 검색
```
월간 전송량: 300 KB × 30일 = 9 MB
```

## 💰 비용 계산

### Free Tier 한도
- **데이터 전송량 (Egress)**: 5 GB/월 = 5,000 MB/월

### 현재 사용량
- **최대 예상**: 9 MB/월
- **사용률**: 9 MB / 5,000 MB = **0.18%** ✅

### 결론
- **Free Tier 범위 내**: ✅
- **비용 발생**: ❌ 없음
- **여유 공간**: 99.82% 남음

## 🎯 실제 사용 패턴

### 검색어 변경 + 새로고침 시나리오

**예시: 하루 동안**
```
1. "인생사연" 검색 → 10개 영상 → 20회 VPH 쿼리
2. 새로고침 → 10개 영상 → 20회 VPH 쿼리
3. "요리" 검색 → 10개 영상 → 20회 VPH 쿼리
4. 새로고침 → 10개 영상 → 20회 VPH 쿼리
...
(반복 10회)
─────────────────────────────
총: 200회 VPH 쿼리
전송량: 약 60 KB
```

**월간 예상:**
```
하루 60 KB × 30일 = 1.8 MB/월
```

## ✅ 최종 답변

### Q: 검색어를 바꾸면서 새로고침해서 view_history를 계속 가져와도 돈이 들지 않나요?

### A: **전혀 비용이 들지 않습니다!**

**이유:**
1. ✅ **API 요청**: Free Tier에서 무제한
2. ✅ **데이터 전송량**: 매우 적음 (MB 단위)
3. ✅ **Free Tier 한도**: 5 GB/월 (현재 사용량: 1.8 MB/월)
4. ✅ **여유 공간**: 99.96% 남음

**비용 발생 조건:**
- 데이터 전송량이 5 GB/월을 초과해야 함
- 현재 사용량은 약 0.04% 수준
- **약 2,700배 여유 있음** ✅

## 📝 참고사항

### 최적화 (이미 적용됨)
- ✅ LocalStorage 캐시 (5분 TTL)
- ✅ 복합 인덱스로 쿼리 최적화
- ✅ 배치 쿼리 최소화

### 모니터링 권장
- Supabase Dashboard에서 월간 Egress 사용량 확인
- 현재는 매우 안전한 수준

## 🎉 결론

**검색어를 아무리 많이 바꾸고 새로고침을 해도:**
- ✅ **비용 $0**
- ✅ **Free Tier 범위 내**
- ✅ **안심하고 사용 가능**

